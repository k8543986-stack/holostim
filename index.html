<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Holostim ‚Äî Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

  <!-- Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="styles.css">
  
  <style>
    /* –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ */
    * {
      box-sizing: border-box;
    }
    
    /* –î–ª—è iOS Safari - —Ñ–∏–∫—Å –≤—ã—Å–æ—Ç—ã */
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
  </style>
</head>
<body>

<!-- ================= –≠–ö–†–ê–ù –û–ù–ë–û–†–î–ò–ù–ì–ê ================= -->
<div id="screen-onboarding" class="screen">
  <div class="onboarding-card">

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —à–∞–≥–æ–≤ -->
    <div class="steps-indicator">
      <span class="step-dot active" data-step="1"></span>
      <span class="step-dot" data-step="2"></span>
      <span class="step-dot" data-step="3"></span>
    </div>

    <!-- –®–∞–≥ 1 -->
    <div class="onboarding-step active" id="step-gender">
      <h1>–í—ã–±–µ—Ä–∏ —Å–≤–æ–µ–≥–æ –±–æ–π—Ü–∞</h1>
      <p>–≠—Ç–æ—Ç –≤—ã–±–æ—Ä –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–≤–æ–π —Ñ–æ–Ω</p>

      <div class="wick-gender-screen">
        <img src="assets/img/johnwick_gender.jpg" class="wick-bg">
        <div class="wick-overlay"></div>

        <button class="wick-zone wick-male"
                onclick="chooseGender('male')"></button>

        <button class="wick-zone wick-female"
                onclick="chooseGender('female')"></button>

        <div class="wick-label wick-label-male">–ú–£–ñ–ß–ò–ù–ê</div>
        <div class="wick-label wick-label-female">–î–ï–í–£–®–ö–ê</div>
      </div>
    </div>

    <!-- –®–∞–≥ 2 -->
    <div class="onboarding-step" id="step-nickname">
      <h1>–ö–∞–∫ —Ç–µ–±—è –Ω–∞–∑—ã–≤–∞—Ç—å?</h1>
      <p>–≠—Ç–æ—Ç –Ω–∏–∫ –±—É–¥—É—Ç –≤–∏–¥–µ—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ</p>

      <input type="text" id="nicknameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫">
      <button class="btn-primary" onclick="saveNickname()">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –®–∞–≥ 3 -->
    <div class="onboarding-step" id="step-consent">
      <h1>–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ</h1>
      <p>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö</p>

      <label class="consent">
        <input type="checkbox" id="consentCheckbox">
        –Ø —Å–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
      </label>

      <button class="btn-primary" id="finishBtn" disabled
              onclick="finishRegistration()">
        –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
      </button>
    </div>

  </div>
</div>

<!-- ================= –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù ================= -->
class="screen" style="display:none">
  <!-- –§–æ–Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –¢–û–õ–¨–ö–û –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ -->
  <div class="screen-main-bg" id="main-bg"></div>

  <div class="main-container">
    <header>
      <div>
        <div class="title">HOLOSTIM</div>
        <div class="subtitle">–ü—Ä–æ—Ñ–∏–ª—å —Å—Ç—Ä–µ–ª–∫–∞ ¬∑ –õ–∏—á–Ω—ã–π —Å–∫–ª–∞–¥</div>
      </div>
      <div class="balance" id="headerBalance">
        –ó–∞–≥—Ä—É–∑–∫–∞...
      </div>
    </header>

    <nav class="top-tabs">
      <button class="tab active" data-tab="sklad">–°–∫–ª–∞–¥</button>
      <button class="tab" data-tab="progress">–ü—Ä–æ–≥—Ä–µ—Å—Å</button>
      <button class="tab" data-tab="shop">–ú–∞–≥–∞–∑–∏–Ω</button>
    </nav>

    <main>
      <!-- –í–∫–ª–∞–¥–∫–∞ –°–ö–õ–ê–î -->
      <section class="tab-content active" id="tab-sklad">
        <div class="layout">
          <section class="character-card">
            <div class="character-header">
              <div class="character-class">–°—Ç—Ä–µ–ª–æ–∫ Holostim</div>
              <div class="character-level" id="charLevel">LVL 1 ¬∑ –ù–æ–≤–∏—á–æ–∫</div>
            </div>

            <div class="character-body">
              <div class="avatar-wrapper" id="avatar">
                –§–æ—Ç–æ
              </div>
              <label class="upload-avatar-btn">
                <input type="file" accept="image/*" id="avatarInput">
                <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</span>
              </label>

              <div class="character-silhouette">
                –¢—É—Ç –±—É–¥–µ—Ç –º–æ–¥–µ–ª—å –±–æ–π—Ü–∞
              </div>
            </div>

            <div class="character-footer">
              <div class="xp-bar-label">
                <span>–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                <span id="xpLabel">0 / 100 XP</span>
              </div>
              <div class="xp-bar">
                <div class="xp-bar-fill" id="xpFill" style="width:0%"></div>
              </div>
              <div class="character-actions">
                <button class="btn-primary" onclick="startSession()">–í –ë–û–ô</button>
                <button class="btn-ghost">–¢–∞—Ä–∏—Ñ—ã</button>
              </div>
            </div>
          </section>

          <section class="right-column">
            <div class="panel">
              <div class="panel-title">–†–µ–∂–∏–º—ã</div>
              <div class="modes-grid">
                <div class="mode-card">–°—Ç–∞–Ω–¥–∞—Ä—Ç</div>
                <div class="mode-card">–†–µ–∞–∫—Ü–∏—è</div>
                <div class="mode-card">–î—É—ç–ª—å</div>
                <div class="mode-card">–ù–æ—á–Ω–æ–π</div>
              </div>
            </div>

            <div class="panel">
              <div class="panel-title">–ê—á–∏–≤–∫–∏</div>
              <div class="achievements-list">
                <div class="ach-badge gold">‚≠ê –ù–æ–≤–æ–±—Ä–∞–Ω–µ—Ü</div>
                <div class="ach-badge silver">üéØ –ú–µ—Ç–∫–∏–π</div>
                <div class="ach-badge bronze">üî• –°–µ—Ä–∏—è</div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <section class="tab-content" id="tab-progress">
        <div class="placeholder-card">
          –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π
        </div>
      </section>

      <section class="tab-content" id="tab-shop">
        <div class="placeholder-card">
          –ú–∞–≥–∞–∑–∏–Ω –∏ –ø–æ–¥–ø–∏—Å–∫–∏
        </div>
      </section>
      
      <!-- DEV –∫–Ω–æ–ø–∫–∞ (–≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ) -->
      <button
        id="dev-reset-btn"
        onclick="resetAccount()"
        style="
          display: none;
          margin: 24px auto 0;
          padding: 8px 14px;
          font-size: 12px;
          opacity: 0.6;
          border-radius: 999px;
          border: 1px dashed rgba(255,255,255,0.4);
          background: transparent;
          color: #fff;
          cursor: pointer;
        ">
        üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç (DEV)
      </button>
    </main>
  </div>
</div>

<!-- ================= –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –õ–û–ì–ò–ö–ò ================= -->
<script src="state.js"></script>
<script src="ui.js"></script>
<script src="app.js"></script>

<script>
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
  document.addEventListener('DOMContentLoaded', function() {
    // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –≤ Telegram
    if (window.Telegram && window.Telegram.WebApp) {
      const tg = window.Telegram.WebApp;
      tg.expand();
      tg.enableClosingConfirmation();
    }
    
    // –§–∏–∫—Å –¥–ª—è iOS Safari 100vh –ø—Ä–æ–±–ª–µ–º—ã
    function setFullHeight() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
      
      const screens = document.querySelectorAll('.screen');
      screens.forEach(screen => {
        screen.style.minHeight = window.innerHeight + 'px';
      });
      
      const cards = document.querySelectorAll('.onboarding-card');
      cards.forEach(card => {
        card.style.minHeight = window.innerHeight + 'px';
      });
    }
    
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã—Å–æ—Ç—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
    setFullHeight();
    window.addEventListener('resize', setFullHeight);
    window.addEventListener('orientationchange', setFullHeight);
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (fallback –µ—Å–ª–∏ –Ω–µ—Ç –∫–∞—Ä—Ç–∏–Ω–æ–∫)
    setTimeout(() => {
      const bgImg = document.querySelector('.wick-bg');
      if (bgImg && bgImg.naturalHeight === 0) {
        console.warn('–§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
        bgImg.style.display = 'none';
        document.querySelector('.wick-gender-screen').style.background = 'linear-gradient(135deg, #1a1a2e, #16213e)';
      }
    }, 1000);
  });
</script>

</body>
</html>