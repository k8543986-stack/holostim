<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Holostim — 3D Профиль</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <!-- Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- Библиотека для отображения 3D-моделей -->
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at top, #1c2738 0, #050810 55%, #020308 100%);
      color: #fff;
      overflow: hidden;
    }

    /* Шапка */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .title { font-size: 16px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; }
    #username { color: #ffcc33; font-size: 13px; font-weight: 600; }

    /* Вкладки */
    .top-tabs { display: flex; background: rgba(5,8,16,0.4); border-bottom: 1px solid rgba(255,255,255,0.05); }
    .tab { padding: 12px 20px; color: #7f8aa1; font-size: 12px; font-weight: 700; text-transform: uppercase; cursor: pointer; }
    .tab.active { color: #ffcc33; border-bottom: 2px solid #ffcc33; }

    main { padding: 15px; }
    .layout { display: grid; grid-template-columns: 340px 1fr; gap: 20px; }

    /* Карточка персонажа */
    .character-card {
      position: relative;
      background: rgba(10, 12, 20, 0.85);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.1);
      padding: 15px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }
    
    .character-body {
      position: relative;
      border-radius: 20px;
      background: radial-gradient(circle at 50% 30%, #2a354d 0%, #0a0c14 100%);
      height: 480px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Переключатель пола */
    .gender-switch {
      position: absolute;
      top: 15px;
      right: 15px;
      z-index: 100;
      display: flex;
      background: rgba(0,0,0,0.7);
      border-radius: 12px;
      padding: 4px;
      border: 1px solid rgba(255,255,255,0.15);
    }
    .gender-btn {
      padding: 8px 12px;
      border: none;
      background: transparent;
      color: #fff;
      font-size: 14px;
      border-radius: 8px;
      cursor: pointer;
    }
    .gender-btn.active { background: #ffcc33; color: #000; font-weight: bold; }

    model-viewer { width: 100%; height: 100%; outline: none; }

    /* Индикатор загрузки */
    #lazy-load-poster {
      position: absolute;
      left: 0; right: 0; top: 0; bottom: 0;
      display: flex; justify-content: center; align-items: center;
      background: rgba(10,12,20,0.5);
      color: #ffcc33; font-weight: bold; font-size: 14px;
      z-index: 5;
    }

    .btn-primary {
      width: 100%; padding: 18px; margin-top: 15px; border-radius: 16px; border: none;
      background: linear-gradient(135deg, #ffcc33 0%, #ff9540 100%);
      color: #000; font-size: 15px; font-weight: 900; text-transform: uppercase;
      box-shadow: 0 8px 25px rgba(255, 149, 64, 0.3);
    }

    /* Правая колонка */
    .panel { background: rgba(10, 12, 20, 0.6); border-radius: 24px; border: 1px solid rgba(255,255,255,0.08); padding: 20px; }
    .panel-title { font-size: 11px; font-weight: 800; text-transform: uppercase; color: #7f8aa1; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
    .panel-title::before { content: ""; width: 3px; height: 12px; background: #ffcc33; border-radius: 2px; }

    @media (max-width: 780px) {
      .layout { grid-template-columns: 1fr; }
      .character-body { height: 420px; }
    }
  </style>
</head>
<body>

<header>
  <div class="title">HOLOSTIM 3D</div>
  <div id="username">@player</div>
</header>

<div class="top-tabs">
  <div class="tab active">Склад</div>
  <div class="tab">Данные</div>
</div>

<main>
  <div class="layout">
    <div class="character-card">
      <div class="gender-switch">
        <button class="gender-btn active" id="mBtn" onclick="setGender('male')">♂</button>
        <button class="gender-btn" id="fBtn" onclick="setGender('female')">♀</button>
      </div>

      <div class="character-body">
        <div id="lazy-load-poster" style="display:none;">ЗАГРУЗКА 3D...</div>
        <model-viewer 
          id="soldierModel"
          src="https://threejs.org/examples/models/gltf/Soldier.glb" 
          auto-rotate rotation-speed="0.5" camera-controls disable-zoom
          shadow-intensity="1" exposure="1" environment-image="neutral">
        </model-viewer>
      </div>

      <button class="btn-primary" onclick="tg.showAlert('Боевая готовность!')">В Бой</button>
    </div>

    <div class="right-column">
      <div class="panel">
        <div class="panel-title">Сводка</div>
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
          <span style="color:#9aa3b5">Точность</span>
          <span style="font-weight:bold">84%</span>
        </div>
        <div style="display:flex; justify-content:space-between;">
          <span style="color:#9aa3b5">Ранг</span>
          <span style="font-weight:bold; color:#ffcc33">Ветеран</span>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  
  if (tg.initDataUnsafe?.user) {
    document.getElementById('username').textContent = `@${tg.initDataUnsafe.user.username || tg.initDataUnsafe.user.first_name}`;
  }

  const modelViewer = document.getElementById('soldierModel');
  const poster = document.getElementById('lazy-load-poster');

  // Показываем надпись при смене модели
  modelViewer.addEventListener('load', () => { poster.style.display = 'none'; });

  function setGender(gender) {
    tg.HapticFeedback.impactOccurred('medium');
    poster.style.display = 'flex';
    
    if (gender === 'male') {
      modelViewer.src = "https://threejs.org/examples/models/gltf/Soldier.glb";
      document.getElementById('mBtn').classList.add('active');
      document.getElementById('fBtn').classList.remove('active');
    } else {
      // Прямая ссылка на качественную модель девушки-солдата
      modelViewer.src = "https://models.readyplayer.me/651f98d780961b695c026e63.glb"; 
      document.getElementById('fBtn').classList.add('active');
      document.getElementById('mBtn').classList.remove('active');
    }
  }
</script>
</body>
</html>
